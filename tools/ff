#!/bin/bash

path=$(fzf)
[ -z "$path" ] && exit 0

abs_path="$(realpath -m "$path" 2>/dev/null || echo "$path")"

echo "relative path is $path"
echo "absolute path is $abs_path"

# follow symbolic link
file_info=$(file -L "$path")
echo "file_info: $file_info"

# ---------- directory ----------
if [ -d "$path" ]; then
    cd "$path" || exit
    pwd
    history -s "cd $path"
    exit 0
fi

# ---------- html ----------
if [[ "$file_info" == *"HTML"* ]]; then
    google-chrome-stable "$abs_path" >/dev/null 2>&1 &
    exit 0
fi

# ---------- text-like ----------
if [[ "$file_info" == *"text"* ]] \
   || [[ "$file_info" == *"ASCII"* ]] \
   || [[ "$file_info" == *"UTF-8"* ]] \
   || [[ "$file_info" == *"diff"* ]] \
   || [[ "$file_info" == *"patch"* ]] \
   || [[ "$file_info" == *"script"* ]]; then

    vim "$path"
    history -s "vim $path"
    exit 0
fi

# ---------- fallback ----------
xdg-open "$abs_path" >/dev/null 2>&1 &

